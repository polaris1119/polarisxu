---
title: "Rust 劝退系列 09：函数"
date: 2021-07-03T22:30:00+08:00
toc: true
isCJKLanguage: true
tags: 
  - rust
  - 函数
---

大家好，我是站长 polarisxu。

这是 Rust 劝退系列的第 9 个教程，探讨 Rust 中的函数。

Rust 是支持函数式编程的语言。Rust 中，函数作为一等公民，本身就是一种类型。函数类型变量可以作为其他函数的参数或返回值，也可以赋值给别的变量，还可以直接调用执行。

## 01 函数定义

在 Rust 中，函数使用 fn 关键字定义（Go 中使用 func，想着够省略了，没想到 Rust 来个更省略！）。

和大部分其他语言的语法类似，Rust 中的函数签名同样包括函数名、函数参数类型和返回值类型。和 Go 语言的函数比，Rust 的函数定义有些不同：

- 除了上面说的关键字不同外，Rust 函数名一般建议使用下划线风格（小写字母），即 蛇形命名法（snake_case），否则编译器会警告；而 Go 使用驼峰风格；
- 返回值类型使用 -> 标识；
- 大括号虽然没有严格要求怎么放，但一般建议紧接函数签名之后，而不是另起一行（Go 是只能这样）；

函数声明如下：

```rust
fn functionname(parametername: type) -> returntype {  
    // 函数体（具体实现的功能）
}
```

函数示例：

```rust
fn max(x: i32, y: i32) -> i32 {
  if x > y {
    return x;
  }
  return y;
}
```

## 02 函数参数

注意，和 Go 不同，虽然上面示例中，x、y 的类型相同，但 x 的类型不能省略。

和 Go 语言一样，Rust 中的函数也没有不能指定默认值。但 Go 支持不定参数，Rust目前不支持。

```go
// Go 中这样的函数，Rust 不支持
func Sum(x, y int, z ...int) int {
  // 函数体
}
```

函数参数和变量一样，默认是不可变的，当需要可变参数时，一样得使用 mut 关键字。看一个例子：（来自 《Rust 编程之道》）

```rust
fn modify(mut v: Vec<u32>) -> Vec<u32> {
  v.push(4);
  v
}

fn main() {
  let v = vec![1, 2, 3];
  let v = modify(v);
  println!("{:?}", v);
}
```

按值传递参数，函数里需要对传入其中的动态数组进行修改，因此在参数前加上了 mut 关键字。正因为函数参数前使用了 mut（这叫做可变修饰），因此在 main 里的声明和调用处并没有使用 mut。

再看另一种情况：

```rust
fn modify(v: &mut Vec<u32>) {
  v.push(4);
}

fn main() {
  let mut v = vec![1, 2, 3];
  modify(&mut v);
  println!("{:?}", v);
}
```

这是按引用传递参数。注意 mut 的位置：按值传递，参数可变，mut 放在参数前，这和定义可变变量是一样的写法；但按引用传递，`&mut Vec<u32>` 这是一个整体，是可变引用类型，因此参数前面不再需要 mut。（mut 位置不一样，着实容易晕！）

此外，函数参数可以使用 `_` 忽略该它。

## 03 函数返回值

如果函数没有返回值，-> 不写。其实，根据前面的介绍，没有返回值的函数，返回的类型是单元值 `()`。所以，也可以显示返回该类型。

虽然 Rust 不支持多返回值，但因为有元组类型，因此返回元组相当于支持多返回值。

```rust
fn main() {
  let (x, y) = swap(2, 3);
  println!("x={},y={}", x, y);
}

fn swap(x: i32, y: i32) -> (i32, i32) {
    (y, x)
}
```

不知道大家是否注意到，swap 函数要求返回一个元组，但我们并没有使用 return 语句，但要特别注意结尾是没有分号的。

前面说过，Rust 中一切都是表达式。if 表达式、循环表达式等，它们的值是最后一个表达式的值。对于函数，它的返回值是最后一个表达式的值。所以，Rust 中经常不通过 return 来返回值。当然，用 return 也是可以的，但需要注意加上分号。

## 04 特殊函数 main

这个不用多说，是 Rust 程序的入口函数，签名如下：

```rust
fn main()
```

没有参数、没有返回值。

## 05 总结

关于函数还有很多其他知识点，比如高阶函数、方法、闭包等，下一节就介绍高阶函数和闭包。

